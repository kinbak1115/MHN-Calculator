<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>怪物猎人数据/伤害计算器</title>
    <style>
        /* CSS 样式 - 调整以适应单页显示且不改变字体大小 */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* 内容从顶部开始 */
            min-height: 100vh;
            margin: 10px 0; /* 缩小整体页面的上下外边距 */
            color: #333;
            font-size: 15px; /* 设定基础字体大小，进一步缩小 */
            -webkit-text-size-adjust: 100%; /* 防止Safari等浏览器自动调整字体大小 */
            text-size-adjust: 100%;
        }

        .container {
            background-color: #ffffff;
            padding: 15px 20px; /* 进一步缩小内边距 */
            border-radius: 8px; /* 略微缩小圆角 */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1); /* 略微缩小阴影 */
            width: 99%; /* 增大宽度，最大化利用屏幕空间 */
            max-width: 1280px; /* 增加最大宽度以容纳更多并排内容 */
            display: flex; /* 使用 Flexbox 布局 */
            flex-wrap: wrap; /* 允许内容换行 */
            gap: 15px; /* 各个section之间的间距 */
            align-items: flex-start; /* 让内容在顶部对齐 */
        }

        h1 {
            width: 100%; /* 标题占据整行 */
            text-align: center;
            color: #2c3e50;
            margin-bottom: 15px; /* 缩小底部外边距 */
            font-size: 1.8em; /* 略微缩小字体 */
            border-bottom: 1px solid #e0e0e0; /* 略微缩小边框 */
            padding-bottom: 6px; /* 缩小底部内边距 */
        }

        h2 {
            width: 100%; /* 副标题占据其section的整行 */
            color: #34495e;
            margin-top: 0; /* 移除顶部外边距 */
            margin-bottom: 8px; /* 缩小底部外边距 */
            border-left: 4px solid #3498db; /* 略微缩小边框 */
            padding-left: 8px; /* 缩小内边距 */
            font-size: 1.2em; /* 略微缩小字体大小 */
        }

        .section {
            flex: 1; /* 每个section弹性伸缩 */
            min-width: 280px; /* 保证每个section最小宽度，适应更多列 */
            max-width: calc(33.33% - 10px); /* 尝试三列布局，减去gap */
            padding: 12px; /* 缩小内边距 */
            background-color: #f9f9f9;
            border-radius: 6px; /* 略微缩小圆角 */
            border: 1px solid #eee;
            box-sizing: border-box; /* 包含 padding 和 border 在宽度内 */
            display: flex; /* section内部也使用flex布局 */
            flex-direction: column; /* 垂直堆叠内容 */
        }

        .input-group {
            margin-bottom: 8px; /* 进一步缩小输入组间距 */
        }

        label {
            display: block;
            margin-bottom: 2px; /* 进一步缩小标签底部外边距 */
            font-weight: bold;
            color: #555;
            font-size: 0.85em; /* 进一步缩小标签字体 */
        }

        input[type="number"],
        select,
        input[type="text"] {
            width: calc(100% - 12px); /* 适应新的padding */
            padding: 6px; /* 缩小输入框内边距 */
            border: 1px solid #ccc;
            border-radius: 4px; /* 略微缩小圆角 */
            box-sizing: border-box;
            font-size: 0.9em; /* 进一步缩小输入框字体 */
        }

        input[type="number"]:focus,
        select:focus,
        input[type="text"]:focus {
            border-color: #3498db;
            box-shadow: 0 0 4px rgba(52, 152, 219, 0.5); /* 略微缩小阴影 */
            outline: none;
        }

        .hitzone-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 8px; /* 缩小顶部外边距 */
        }
        .hitzone-table th, .hitzone-table td {
            border: 1px solid #ddd;
            padding: 4px; /* 进一步缩小表格内边距 */
            text-align: left;
            font-size: 0.85em; /* 进一步缩小表格字体 */
        }
        .hitzone-table th {
            background-color: #e2eafc;
            font-weight: bold;
        }
        .hitzone-table input {
            width: 45px; /* 进一步缩小输入框宽度 */
            padding: 2px; /* 进一步缩小输入框内边距 */
            font-size: 0.85em; /* 进一步缩小输入框字体 */
        }

        button {
            width: calc(100% - 30px); /* 按钮宽度适配container padding */
            margin: 15px 15px 0 15px; /* 左右居中，上下边距 */
            padding: 8px 12px; /* 缩小内边距 */
            font-size: 1em; /* 略微缩小字体 */
            position: relative;
            left: 50%;
            transform: translateX(-50%);
            flex-shrink: 0; /* 防止按钮被压缩 */
            border-radius: 4px; /* 略微缩小圆角 */
        }

        .result-section {
            width: 100%; /* 结果区占据整行 */
            margin-top: 15px; /* 缩小顶部外边距 */
            padding: 12px; /* 缩小内边距 */
            background-color: #e8f5e9;
            border: 1px solid #d4edda;
            border-radius: 8px;
            text-align: center;
        }

        .result-section p {
            font-size: 1em; /* 略微缩小结果字体 */
            margin-bottom: 6px;
            color: #28a745;
            font-weight: bold;
        }

        .result-section p:last-child {
            margin-bottom: 0;
            font-size: 1.1em; /* 略微缩小总伤害字体 */
            color: #007bff;
        }

        span {
            color: #d35400;
            font-weight: bold;
        }

        .info-tip {
            font-size: 0.7em; /* 进一步缩小提示文字 */
            color: #777;
            margin-top: -6px; /* 进一步缩小顶部外边距 */
            margin-bottom: 6px;
            display: block;
        }

        /* 确保flex项不会因为内容过少而拉伸 */
        .section > h2 {
            flex-shrink: 0;
        }
        .section > .input-group {
            flex-shrink: 0;
        }
        .section > .hitzone-table {
            flex-grow: 1; /* 让表格可以占据更多空间 */
            display: flex;
            flex-direction: column;
        }
        .hitzone-table tbody {
            flex-grow: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>怪物猎人数据/伤害计算器</h1>

        <div class="section">
            <h2>通用设置</h2>
            <div class="input-group">
                <label for="gameMode">模式:</label>
                <select id="gameMode">
                    <option value="solo">单人</option>
                    <option value="team">团队</option>
                </select>
            </div>
            <div class="input-group">
                <label for="attackDirection">攻击方向:</label>
                <select id="attackDirection">
                    <option value="front">前方</option>
                    <option value="back">后方</option>
                </select>
            </div>
            <div class="input-group">
                <label for="monsterSelect">魔物选择:</label>
                <select id="monsterSelect" onchange="loadMonsterHitzones()">
                    <option value="greatJagras">大凶豺龙</option>
                    </select>
            </div>
            <div class="input-group">
                <label for="attackPart">攻击部位:</label>
                <select id="attackPart" onchange="updateHitzones()">
                    <option value="head">头</option>
                    <option value="leftHorn">左角</option>
                    <option value="rightHorn">右角</option>
                    <option value="snout">吻部</option>
                    <option value="neck">颈部</option>
                    <option value="belly">腹部</option>
                    <option value="back">背</option>
                    <option value="frontLeg">前脚</option>
                    <option value="backLeg">后脚</option>
                    <option value="wing">翼</option>
                    <option value="tail">尾巴</option>
                    <option value="tailTip">尾巴尖端</option>
                </select>
                <span class="info-tip">肉质数值会根据选择的怪物和部位自动更新，你也可以手动修改。</span>
            </div>
            <div class="input-group">
                <label for="weaponElementType">武器攻击属性:</label>
                <select id="weaponElementType">
                    <option value="none">无</option>
                    <option value="fire">火</option>
                    <option value="water">水</option>
                    <option value="thunder">雷</option>
                    <option value="ice">冰</option>
                    <option value="dragon">龙</option>
                </select>
            </div>
        </div>

        <div class="section">
            <h2>基础属性与技能加成</h2>
            <div class="input-group">
                <label for="baseHealth">体力:</label>
                <input type="number" id="baseHealth" value="100" min="0">
            </div>
            <div class="input-group">
                <label for="friendHealthBonus">好友赠送体力:</label>
                <input type="number" id="friendHealthBonus" value="0" min="0">
            </div>
            <div class="input-group">
                <label for="skillHealthBonus">技能增加体力:</label>
                <input type="number" id="skillHealthBonus" value="0" min="0">
            </div>
            <div class="input-group">
                <label for="baseDefense">防御力:</label>
                <input type="number" id="baseDefense" value="500" min="0">
            </div>
            <div class="input-group">
                <label for="skillDefenseBonus">技能增加防御力:</label>
                <input type="number" id="skillDefenseBonus" value="0" min="0">
            </div>
        </div>
        
        <div class="section">
            <h2>攻击力与会心</h2>
            <div class="input-group">
                <label for="baseWeaponRawAttack">武器面板攻击力:</label>
                <input type="number" id="baseWeaponRawAttack" value="200" min="0">
            </div>
            <div class="input-group">
                <label for="skillRawAttackBonus">技能增加攻击力 (固定值):</label>
                <input type="number" id="skillRawAttackBonus" value="0" min="0">
            </div>
            <div class="input-group">
                <label for="baseWeaponElementAttack">武器面板属性攻击力:</label>
                <input type="number" id="baseWeaponElementAttack" value="0" min="0">
            </div>
            <div class="input-group">
                <label for="skillElementAttackBonus">技能增加属性攻击力 (固定值):</label>
                <input type="number" id="skillElementAttackBonus" value="0" min="0">
            </div>
            <div class="input-group">
                <label for="baseAffinity">会心率 (%):</label>
                <input type="number" id="baseAffinity" value="0" min="-100" max="100">
            </div>
            <div class="input-group">
                <label for="skillAffinityBonus">技能增加会心率 (%):</label>
                <input type="number" id="skillAffinityBonus" value="0" min="-100" max="100">
            </div>
            <div class="input-group">
                <label for="baseCritMultiplier">正会心倍率 (通常1.25):</label>
                <input type="number" id="baseCritMultiplier" value="1.25" step="0.01">
            </div>
            <div class="input-group">
                <label for="skillCritMultiplierBonus">技能增加会心倍率 (如超会心, +0.05/级):</label>
                <input type="number" id="skillCritMultiplierBonus" value="0" step="0.01">
            </div>
            <div class="input-group">
                <label for="negativeCritMultiplier">负会心伤害修正 (通常0.75):</label>
                <input type="number" id="negativeCritMultiplier" value="0.75" step="0.01">
            </div>
        </div>

        <div class="section">
            <h2>伤害相关乘数</h2>
            <div class="input-group">
                <label for="skillDamageMultiplier">技能增加伤害倍率 (攻击%类，如挑战者+20%写1.2):</label>
                <input type="number" id="skillDamageMultiplier" value="1.0" step="0.01">
            </div>
            <div class="input-group">
                <label for="motionValue">动作值 (MV, 百分比, 如50表示50):</label>
                <input type="number" id="motionValue" value="50" min="1" max="500">
            </div>
            <div class="input-group">
                <label for="weaponSpPower">武器SP技能威力 (如太刀红刃1.2):</label>
                <input type="number" id="weaponSpPower" value="1.0" step="0.01">
                <span class="info-tip">影响最终伤害的特殊倍率</span>
            </div>
            <div class="input-group">
                <label for="spGauge">SP计量表 (%):</label>
                <input type="number" id="spGauge" value="100" min="0" max="100">
                <span class="info-tip">例如太刀气刃槽，影响SP技能威力是否激活或程度</span>
            </div>
            <div class="input-group">
                <label for="skillSpGaugeBonus">技能增加SP计量表 (%):</label>
                <input type="number" id="skillSpGaugeBonus" value="0" min="0" max="100">
            </div>
        </div>

        <div class="section">
            <h2>异常状态</h2>
            <div class="input-group">
                <label for="hunterStatus">猎人异常状态:</label>
                <select id="hunterStatus">
                    <option value="none">无</option>
                    <option value="ghostfire">鬼火</option>
                    <option value="foamDance">泡沫之舞</option>
                    <option value="tear">撕裂</option>
                </select>
            </div>
            <div class="input-group">
                <label for="monsterStatus">怪物异常状态:</label>
                <select id="monsterStatus">
                    <option value="none">无</option>
                    <option value="paralysis">麻痺</option>
                    <option value="sleep">睡眠</option>
                    <option value="poison">中毒</option>
                    <option value="stun">晕眩</option>
                </select>
            </div>
        </div>

        <div class="section">
            <h2>怪物肉质设置</h2>
            <table class="hitzone-table">
                <thead>
                    <tr>
                        <th>肉质类型</th>
                        <th>数值 (%)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>物理肉质 (斩击/打击/弹)</td>
                        <td><input type="number" id="hitzoneRaw" value="45" min="0" max="100"></td>
                    </tr>
                    </tbody>
            </table>
            <span class="info-tip" style="margin-top: 10px;">属性肉质会根据选择的**武器攻击属性**自动从魔物数据中读取。</span>
        </div>

        <button onclick="calculateData()">计算所有数据</button>

        <div class="result-section">
            <h2>计算结果</h2>
            <p>最终总体力: <span id="finalTotalHealth">0</span></p>
            <p>最终总防御力: <span id="finalTotalDefense">0</span></p>
            <p>最终会心率 (期望): <span id="finalAffinityRate">0%</span></p>
            <p>最终物理伤害: <span id="finalRawDamage">0</span></p>
            <p>最终属性伤害: <span id="finalElementDamage">0</span></p>
            <p>总伤害: <span id="totalDamage">0</span></p>
            <p style="font-size:0.7em; color:#777; margin-top:10px;">注意：此计算器基于提供的公式，并假设SP威力、动作值、肉质等对最终总伤害的计算方式。不同游戏版本和招式细节可能有所差异。</p>
        </div>
    </div>

    <script>
        // 魔物肉质数据 (示例：大凶豺龙)
        // 注意：这里的肉质数据仅为示例，你需要根据实际游戏数据进行填充
        // 每个部位需要包含所有属性的肉质
        const MONSTER_HITZONES = {
            'greatJagras': {
                'head': { raw: 60, fire: 20, water: 0, thunder: 30, ice: 0, dragon: 0 },
                'leftHorn': { raw: 30, fire: 10, water: 0, thunder: 20, ice: 0, dragon: 0 },
                'rightHorn': { raw: 30, fire: 10, water: 0, thunder: 20, ice: 0, dragon: 0 },
                'snout': { raw: 45, fire: 15, water: 0, thunder: 25, ice: 0, dragon: 0 },
                'neck': { raw: 40, fire: 10, water: 0, thunder: 20, ice: 0, dragon: 0 },
                'belly': { raw: 80, fire: 30, water: 0, thunder: 40, ice: 0, dragon: 0 }, // 膨胀的肚子是弱点
                'back': { raw: 25, fire: 5, water: 0, thunder: 10, ice: 0, dragon: 0 },
                'frontLeg': { raw: 40, fire: 10, water: 0, thunder: 15, ice: 0, dragon: 0 },
                'backLeg': { raw: 35, fire: 5, water: 0, thunder: 10, ice: 0, dragon: 0 },
                'wing': { raw: 20, fire: 0, water: 0, thunder: 5, ice: 0, dragon: 0 },
                'tail': { raw: 25, fire: 5, water: 0, thunder: 10, ice: 0, dragon: 0 },
                'tailTip': { raw: 30, fire: 10, water: 0, thunder: 15, ice: 0, dragon: 0 },
            }
            // 以后可以在这里添加更多魔物的肉质数据
            /*
            'anotherMonster': {
                'head': { raw: 50, fire: 10, water: 15, thunder: 5, ice: 20, dragon: 0 },
                // ...更多部位
            }
            */
        };

        // 页面加载时初始化肉质
        document.addEventListener('DOMContentLoaded', () => {
            loadMonsterHitzones();
        });

        // 根据选择的怪物和部位更新肉质数值
        // 由于移除了属性肉质输入框，此函数只更新物理肉质
        function loadMonsterHitzones() {
            const monster = document.getElementById('monsterSelect').value;
            const part = document.getElementById('attackPart').value;

            if (MONSTER_HITZONES[monster] && MONSTER_HITZONES[monster][part]) {
                const hitzones = MONSTER_HITZONES[monster][part];
                document.getElementById('hitzoneRaw').value = hitzones.raw;
                // 属性肉质不再在此处更新输入框，而是直接在 calculateData 中读取
            } else {
                document.getElementById('hitzoneRaw').value = 0;
            }
        }

        function updateHitzones() {
            loadMonsterHitzones(); // 当攻击部位改变时，重新加载肉质
        }

        function calculateData() {
            // --- 获取基础属性和技能加成 ---
            const baseHealth = parseFloat(document.getElementById('baseHealth').value);
            const friendHealthBonus = parseFloat(document.getElementById('friendHealthBonus').value || 0);
            const skillHealthBonus = parseFloat(document.getElementById('skillHealthBonus').value || 0);

            const baseWeaponRawAttack = parseFloat(document.getElementById('baseWeaponRawAttack').value);
            const skillRawAttackBonus = parseFloat(document.getElementById('skillRawAttackBonus').value || 0);

            const baseWeaponElementAttack = parseFloat(document.getElementById('baseWeaponElementAttack').value);
            const skillElementAttackBonus = parseFloat(document.getElementById('skillElementAttackBonus').value || 0);

            const baseAffinity = parseFloat(document.getElementById('baseAffinity').value);
            const skillAffinityBonus = parseFloat(document.getElementById('skillAffinityBonus').value || 0);

            const baseCritMultiplier = parseFloat(document.getElementById('baseCritMultiplier').value);
            const skillCritMultiplierBonus = parseFloat(document.getElementById('skillCritMultiplierBonus').value || 0);
            const negativeCritMultiplier = parseFloat(document.getElementById('negativeCritMultiplier').value || 0.75); // 负会心倍率

            const baseDefense = parseFloat(document.getElementById('baseDefense').value);
            const skillDefenseBonus = parseFloat(document.getElementById('skillDefenseBonus').value || 0);

            // --- 获取伤害相关乘数 ---
            const skillDamageMultiplier = parseFloat(document.getElementById('skillDamageMultiplier').value || 1.0); // 技能增加伤害倍率
            const motionValue = parseFloat(document.getElementById('motionValue').value);
            const weaponSpPower = parseFloat(document.getElementById('weaponSpPower').value || 1.0); // 武器SP技能威力
            const spGauge = parseFloat(document.getElementById('spGauge').value || 0); // SP计量表
            const skillSpGaugeBonus = parseFloat(document.getElementById('skillSpGaugeBonus').value || 0); // 技能增加SP计量表

            // --- 怪物/环境信息 ---
            const gameMode = document.getElementById('gameMode').value; // 单人/团队
            const attackDirection = document.getElementById('attackDirection').value; // 前方/后方
            const monsterSelect = document.getElementById('monsterSelect').value;
            const attackPart = document.getElementById('attackPart').value;
            const weaponElementType = document.getElementById('weaponElementType').value; // 武器攻击属性

            const hitzoneRaw = parseFloat(document.getElementById('hitzoneRaw').value) / 100;

            // 根据选择的武器属性，从魔物肉质数据中获取对应的属性肉质
            let hitzoneElement = 0;
            if (weaponElementType !== 'none' && MONSTER_HITZONES[monsterSelect] && MONSTER_HITZONES[monsterSelect][attackPart]) {
                hitzoneElement = MONSTER_HITZONES[monsterSelect][attackPart][weaponElementType] / 100;
            }

            // --- 异常状态 ---
            const hunterStatus = document.getElementById('hunterStatus').value;
            const monsterStatus = document.getElementById('monsterStatus').value;

            // --- 数据计算 ---

            // 1. 体力计算
            const finalTotalHealth = baseHealth + friendHealthBonus + skillHealthBonus;

            // 2. 防御力计算
            const finalTotalDefense = baseDefense + skillDefenseBonus;

            // 3. 会心率计算 (最终会心率)
            let totalAffinity = baseAffinity + skillAffinityBonus;
            totalAffinity = Math.max(-100, Math.min(100, totalAffinity)); // 限制在-100%到100%

            // 4. 会心倍率计算 (物理伤害)
            const finalCritMultiplier = baseCritMultiplier + skillCritMultiplierBonus;

            // 5. SP计量表计算 (简单相加)
            const finalSpGauge = Math.min(100, spGauge + skillSpGaugeBonus); // SP计量表通常有上限

            // --- 伤害计算 ---

            // 物理伤害部分
            // (武器攻击 + 技能增加攻击力) * 技能增加伤害倍率 (攻击%类)
            let effectiveRawAttack = (baseWeaponRawAttack + skillRawAttackBonus) * skillDamageMultiplier;
            
            // 应用动作值 (MV)
            effectiveRawAttack *= (motionValue / 100);

            // 应用肉质 (物理)
            let rawDamageBeforeCrit = effectiveRawAttack * hitzoneRaw;

            // 会心期望值计算 (物理伤害)
            let finalRawDamage;
            if (totalAffinity > 0) {
                finalRawDamage = rawDamageBeforeCrit * (1 + (totalAffinity / 100) * (finalCritMultiplier - 1));
            } else if (totalAffinity < 0) {
                finalRawDamage = rawDamageBeforeCrit * (1 + (totalAffinity / 100) * (negativeCritMultiplier - 1));
            } else {
                finalRawDamage = rawDamageBeforeCrit;
            }

            // 属性伤害部分
            let finalElementDamage = 0;
            if (weaponElementType !== 'none') { // 只有当选择了非“无”属性时才计算属性伤害
                // 武器面板属性通常要除以10 (MHW/IB标准) + 技能增加属性
                // 假设技能增加属性也除10，需根据游戏机制确认
                let effectiveElementAttack = (baseWeaponElementAttack / 10) + (skillElementAttackBonus / 10); 
                
                // 属性斩味修正 (这里假设属性斩味修正为1.0，如果需要，请在HTML中添加相关输入并在此处引入)
                effectiveElementAttack *= 1.0; 

                // 应用属性肉质
                finalElementDamage = effectiveElementAttack * hitzoneElement;
            }


            // SP技能威力 (假设它是一个最终的总伤害乘数)
            let totalDamage = finalRawDamage + finalElementDamage;
            // 仅当SP计量表达到一定阈值时才应用SP技能威力
            if (finalSpGauge >= 100) { // 假设SP技能威力在SP计量表满时激活
                 totalDamage *= weaponSpPower;
            }


            // --- 显示结果 ---
            document.getElementById('finalTotalHealth').textContent = finalTotalHealth.toFixed(0);
            document.getElementById('finalTotalDefense').textContent = finalTotalDefense.toFixed(0);
            document.getElementById('finalAffinityRate').textContent = totalAffinity.toFixed(0) + "%";
            document.getElementById('finalRawDamage').textContent = finalRawDamage.toFixed(2);
            document.getElementById('finalElementDamage').textContent = finalElementDamage.toFixed(2);
            document.getElementById('totalDamage').textContent = totalDamage.toFixed(2);
        }
    </script>
</body>
</html>
