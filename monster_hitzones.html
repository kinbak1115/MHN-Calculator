<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>怪物肉质数据管理</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 20px 0;
            color: #333;
            font-size: 15px;
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }

        .container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 900px;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 2em;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }

        h2 {
            color: #34495e;
            margin-top: 25px;
            margin-bottom: 15px;
            border-left: 5px solid #3498db;
            padding-left: 10px;
            font-size: 1.6em;
        }

        .section {
            margin-bottom: 25px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
            font-size: 0.95em;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: calc(100% - 20px);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 1em;
        }
        input[type="number"].small-input {
            width: 60px; /* Smaller width for numeric inputs in tables */
            text-align: center;
        }

        button {
            padding: 10px 15px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-right: 10px;
        }

        button:hover {
            background-color: #27ae60;
        }

        button.delete-btn {
            background-color: #e74c3c;
        }
        button.delete-btn:hover {
            background-color: #c0392b;
        }

        button.edit-btn {
            background-color: #f39c12;
        }
        button.edit-btn:hover {
            background-color: #e67e22;
        }
        
        .nav-links {
            text-align: center;
            margin-bottom: 20px;
        }
        .nav-links a {
            padding: 8px 15px;
            background-color: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-size: 1em;
            transition: background-color 0.3s ease;
        }
        .nav-links a:hover {
            background-color: #0056b3;
        }

        .monster-list {
            margin-top: 20px;
        }

        .monster-item {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .monster-item-info strong {
            font-size: 1.1em;
            color: #34495e;
        }
        .monster-item-info span {
            display: block;
            font-size: 0.9em;
            color: #777;
        }

        .monster-item-actions button {
            margin-left: 5px;
            padding: 6px 10px;
            font-size: 0.9em;
        }

        .hitzone-edit-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .hitzone-edit-table th, .hitzone-edit-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center; /* Centered for numbers */
        }
        .hitzone-edit-table th {
            background-color: #e2eafc;
            font-weight: bold;
        }
        .hitzone-edit-table td:first-child {
            text-align: left; /* Keep part names left aligned */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav-links">
            <a href="index.html">返回伤害计算器</a>
        </div>

        <h1>怪物肉质数据管理</h1>

        <div class="section">
            <h2>新增/编辑怪物</h2>
            <div class="input-group">
                <label for="monsterId">怪物ID (英文, 唯一):</label>
                <input type="text" id="monsterId" placeholder="例如: greatJagras" disabled>
                <span style="font-size:0.8em; color:#777;">编辑时ID不可修改。</span>
            </div>
            <div class="input-group">
                <label for="monsterName">怪物名称 (中文):</label>
                <input type="text" id="monsterName" placeholder="例如: 大凶豺龙">
            </div>

            <h3>部位肉质设定</h3>
            <button onclick="addPartRow()">添加部位</button>
            <table class="hitzone-edit-table" id="hitzoneTable">
                <thead>
                    <tr>
                        <th>部位名称</th>
                        <th>部位ID (英文)</th>
                        <th>物理</th>
                        <th>火</th>
                        <th>水</th>
                        <th>雷</th>
                        <th>冰</th>
                        <th>龙</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
            <br>
            <button onclick="saveMonster()">保存怪物</button>
            <button onclick="clearForm()">清空表单</button>
        </div>

        <div class="section monster-list">
            <h2>已保存怪物列表</h2>
            <div id="monsterListContainer">
                <p>暂无怪物数据。</p>
            </div>
        </div>
    </div>

    <script>
        // 默认的怪物肉质数据，如果localStorage中没有，则使用此数据初始化
        const DEFAULT_MONSTER_HITZONES = {
            'greatJagras': {
                name: '大凶豺龙',
                parts: {
                    'head': { name: '头', raw: 60, fire: 20, water: 0, thunder: 30, ice: 0, dragon: 0 },
                    'belly': { name: '腹部', raw: 80, fire: 30, water: 0, thunder: 40, ice: 0, dragon: 0 }, // 膨胀的肚子是弱点
                    'neck': { name: '颈部', raw: 40, fire: 10, water: 0, thunder: 20, ice: 0, dragon: 0 },
                    'frontLeg': { name: '前脚', raw: 40, fire: 10, water: 0, thunder: 15, ice: 0, dragon: 0 },
                    'backLeg': { name: '后脚', raw: 35, fire: 5, water: 0, thunder: 10, ice: 0, dragon: 0 },
                    'tail': { name: '尾巴', raw: 25, fire: 5, water: 0, thunder: 10, ice: 0, dragon: 0 },
                }
            },
        };

        let monsterHitzonesData = {}; // 全局变量，用于存储从localStorage加载的数据
        let currentEditingMonsterId = null; // 用于跟踪当前正在编辑的怪物ID

        document.addEventListener('DOMContentLoaded', () => {
            loadMonsterData();
            renderMonsterList();
        });

        // 从 localStorage 加载怪物数据，如果不存在则使用默认数据并保存
        function loadMonsterData() {
            const storedData = localStorage.getItem('monsterHitzonesData');
            if (storedData) {
                monsterHitzonesData = JSON.parse(storedData);
            } else {
                monsterHitzonesData = DEFAULT_MONSTER_HITZONES;
                saveMonsterData(); // 保存默认数据
            }
        }

        // 保存怪物数据到 localStorage
        function saveMonsterData() {
            localStorage.setItem('monsterHitzonesData', JSON.stringify(monsterHitzonesData));
        }

        // 渲染怪物列表
        function renderMonsterList() {
            const container = document.getElementById('monsterListContainer');
            container.innerHTML = '';

            if (Object.keys(monsterHitzonesData).length === 0) {
                container.innerHTML = '<p>暂无怪物数据。</p>';
                return;
            }

            for (const id in monsterHitzonesData) {
                const monster = monsterHitzonesData[id];
                const monsterItem = document.createElement('div');
                monsterItem.className = 'monster-item';
                monsterItem.innerHTML = `
                    <div class="monster-item-info">
                        <strong>${monster.name}</strong> (${id})
                        <span>部位数量: ${Object.keys(monster.parts).length}</span>
                    </div>
                    <div class="monster-item-actions">
                        <button class="edit-btn" onclick="editMonster('${id}')">编辑</button>
                        <button class="delete-btn" onclick="deleteMonster('${id}')">删除</button>
                    </div>
                `;
                container.appendChild(monsterItem);
            }
        }

        // 添加部位行到编辑表格
        function addPartRow(partData = {}) {
            const tbody = document.getElementById('hitzoneTable').getElementsByTagName('tbody')[0];
            const row = tbody.insertRow();
            row.innerHTML = `
                <td><input type="text" class="part-name-input" value="${partData.name || ''}" placeholder="如: 头"></td>
                <td><input type="text" class="part-id-input" value="${partData.id || ''}" placeholder="如: head"></td>
                <td><input type="number" class="small-input raw-input" value="${partData.raw || 0}" min="0" max="100"></td>
                <td><input type="number" class="small-input fire-input" value="${partData.fire || 0}" min="0" max="100"></td>
                <td><input type="number" class="small-input water-input" value="${partData.water || 0}" min="0" max="100"></td>
                <td><input type="number" class="small-input thunder-input" value="${partData.thunder || 0}" min="0" max="100"></td>
                <td><input type="number" class="small-input ice-input" value="${partData.ice || 0}" min="0" max="100"></td>
                <td><input type="number" class="small-input dragon-input" value="${partData.dragon || 0}" min="0" max="100"></td>
                <td><button class="delete-btn" onclick="removePartRow(this)">删除</button></td>
            `;
        }

        // 移除部位行
        function removePartRow(button) {
            const row = button.closest('tr');
            row.remove();
        }

        // 清空表单
        function clearForm() {
            document.getElementById('monsterId').value = '';
            document.getElementById('monsterId').disabled = false; // 新增时ID可编辑
            document.getElementById('monsterName').value = '';
            document.getElementById('hitzoneTable').getElementsByTagName('tbody')[0].innerHTML = ''; // 清空部位表格
            currentEditingMonsterId = null;
        }

        // 保存怪物数据
        function saveMonster() {
            const monsterId = document.getElementById('monsterId').value.trim();
            const monsterName = document.getElementById('monsterName').value.trim();

            if (!monsterId || !monsterName) {
                alert('怪物ID和名称不能为空！');
                return;
            }

            if (currentEditingMonsterId === null && monsterHitzonesData[monsterId]) {
                alert('此怪物ID已存在，请使用其他ID或点击编辑按钮进行修改。');
                return;
            }

            const parts = {};
            const rows = document.getElementById('hitzoneTable').getElementsByTagName('tbody')[0].rows;

            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const partName = row.querySelector('.part-name-input').value.trim();
                const partId = row.querySelector('.part-id-input').value.trim();
                const raw = parseInt(row.querySelector('.raw-input').value) || 0;
                const fire = parseInt(row.querySelector('.fire-input').value) || 0;
                const water = parseInt(row.querySelector('.water-input').value) || 0;
                const thunder = parseInt(row.querySelector('.thunder-input').value) || 0;
                const ice = parseInt(row.querySelector('.ice-input').value) || 0;
                const dragon = parseInt(row.querySelector('.dragon-input').value) || 0;

                if (!partId || !partName) {
                    alert(`部位名称或ID不能为空 (第 ${i + 1} 行)`);
                    return;
                }
                if (parts[partId]) {
                    alert(`部位ID "${partId}" 重复 (第 ${i + 1} 行)，请确保部位ID唯一！`);
                    return;
                }

                parts[partId] = {
                    name: partName,
                    raw: raw,
                    fire: fire,
                    water: water,
                    thunder: thunder,
                    ice: ice,
                    dragon: dragon
                };
            }

            monsterHitzonesData[monsterId] = {
                name: monsterName,
                parts: parts
            };

            saveMonsterData();
            renderMonsterList();
            clearForm();
            alert('怪物数据已保存！');
        }

        // 编辑怪物数据
        function editMonster(id) {
            clearForm(); // 清空当前表单
            const monster = monsterHitzonesData[id];
            if (monster) {
                currentEditingMonsterId = id;
                document.getElementById('monsterId').value = id;
                document.getElementById('monsterId').disabled = true; // 编辑时ID不可修改
                document.getElementById('monsterName').value = monster.name;

                const tbody = document.getElementById('hitzoneTable').getElementsByTagName('tbody')[0];
                tbody.innerHTML = ''; // 清空现有行

                for (const partId in monster.parts) {
                    const part = monster.parts[partId];
                    addPartRow({
                        id: partId,
                        name: part.name,
                        raw: part.raw,
                        fire: part.fire,
                        water: part.water,
                        thunder: part.thunder,
                        ice: part.ice,
                        dragon: part.dragon
                    });
                }
            }
        }

        // 删除怪物数据
        function deleteMonster(id) {
            if (confirm(`确定要删除怪物 "${monsterHitzonesData[id].name}" 吗？此操作不可撤销！`)) {
                delete monsterHitzonesData[id];
                saveMonsterData();
                renderMonsterList();
                if (currentEditingMonsterId === id) { // 如果删除的是当前正在编辑的怪物
                    clearForm();
                }
                alert('怪物已删除！');
            }
        }
    </script>
</body>
</html>